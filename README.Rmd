---
title: "The Metropolitan Transportation Authority of New York City"
author: Anthony Josue Roman
output: github_document
always_allow_html: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r include=FALSE}
# Don't delete this chunk if you are using the DataComputing package
library(DataComputing)
library(mosaic)
library(mosaicData)
library(dplyr)
library(ggplot2)
library(gtfsr)
library(magrittr)
library(dplyr)
require(DataComputing)
require(mosaic)
require(mosaicData)
require(dplyr)
require(ggplot2)
require(gtfsr)
require(magrittr)
require(dplyr)
```
*Source file* 
```{r, results='asis', echo=FALSE}
includeSourceDocuments()
```

I will begin analysing the data provided from New York City's transportation authority, also known as the MTA. The following data used will include success and failure rates for each department.  
In order to use this data, I had to apply through its website in order to obtain this data. The given data will be provided along with this file, and in the website. In order to make this data easier to read, there were csv files created in order to yield a viable graph and for data wrangling purposes.

An HTML Document with an interactive map is shown [here](https://aromedtbf.github.io/STAT-184/project.html).

New York City is one of the most populated cities in the world, and has one of the largest public transportation systems in the world as well.

## New York City Transit
Below is a whole list of NYCT Data and I will work on a few sections for this project.

```{r echo=FALSE, message=FALSE, warning=FALSE}
mtas <- read.csv('MTA_Performance_NYCT.csv')
mtas <-
  mtas %>%
  select(INDICATOR_SEQ,INDICATOR_NAME,PERIOD_YEAR,YTD_TARGET,YTD_ACTUAL)
mtas1 <-
  mtas %>%
  group_by(INDICATOR_NAME,PERIOD_YEAR) %>%
  summarise(avgtarget=mean(YTD_TARGET),avgactual=mean(YTD_ACTUAL))
knitr::kable(mtas1)
```

## New York City Subway

Below is the data gathered from the subway lines, A-Division (also known as the IRT), which consists the 1,2,3,4,5,6 and 7 (technically the BMT/B-Division) lines.  
The B-Division (BMT and IND) consists of the A,B,C,D,E,F,G,J,L,M,N,Q,R,W, and Z lines.

```{r echo=FALSE, message=FALSE, warning=FALSE}
mtas <- read.csv('MTA_Performance_NYCT.csv')
mtas <-
  mtas %>%
  select(INDICATOR_SEQ,INDICATOR_NAME,PERIOD_YEAR,YTD_TARGET,YTD_ACTUAL)
mtass <-
  mtas %>%
  filter(INDICATOR_SEQ %in% c(67816,67823,67923,103929))
mtass <-
  mtass %>%
  group_by(INDICATOR_NAME,PERIOD_YEAR) %>%
  summarise(avgtarget=mean(YTD_TARGET),avgactual=mean(YTD_ACTUAL))
knitr::kable(mtass)
```
  
```{r echo=FALSE, message=FALSE, warning=FALSE}
mtas <- read.csv('MTA_Performance_NYCT.csv')
mtas <-
  mtas %>%
  select(INDICATOR_SEQ,INDICATOR_NAME,PERIOD_YEAR,YTD_TARGET,YTD_ACTUAL)
mtass <- 
  mtas %>%
  filter(INDICATOR_SEQ > 391690)
mtass <-
  mtass %>%
  group_by(INDICATOR_NAME,PERIOD_YEAR) %>%
  summarise(avgtarget=mean(YTD_TARGET),avgactual=mean(YTD_ACTUAL))
knitr::kable(mtass)
```
  
### Total Ridership - NYC Subways

Below is a table for the total annual ridership in the subways from 2008 to 2017.

```{r}
mtas <- read.csv('MTA_Performance_NYCT.csv')
mtas <-
  mtas %>%
  select(INDICATOR_SEQ,INDICATOR_NAME,PERIOD_YEAR,YTD_TARGET,YTD_ACTUAL)
mtass <- 
  mtas %>%
  filter(INDICATOR_SEQ == 103929)
mtass <-
  mtass %>%
  group_by(PERIOD_YEAR) %>%
  summarise(avgtarget=mean(YTD_TARGET),avgactual=mean(YTD_ACTUAL))
knitr::kable(mtass)
```

## New York City Bus

Below is a comparison between the Completed and projected Trips from MTA Bus and MTA New York City Bus. Note: On 2012, Hurricane Sandy did affect service, along with other years due to suspension of service.

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.width=6, fig.height=4}
bustripdata <- read.csv("bustrip.csv")
bustripdata %>% 
  ggplot(aes(x=PERIOD_YEAR,y=count,color=type)) +
  stat_smooth() +
  geom_point() + 
  xlab("Year") + 
  ylab("% of Completed Trips") +
  ggtitle("Complteted trips for the New York City Bus")
```
  
Below is the data used for the graph above, which explains the completed trip percentage per year. The type shows the difference between the actual and target (predicted) data gathered for NYCT Bus.

```{r, echo=FALSE, message=FALSE, warning=FALSE}
bustripdata <- read.csv("bustrip.csv")
bustripdata <-
  bustripdata %>%
  select(PERIOD_YEAR,count,type)
knitr::kable(bustripdata)
```

## Metro North Railroad

This is the Metro North Railroad with multiple indicator types, and I will focus on the MNRR Hudson Harlem and Port Jervis Lines.

```{r, echo=FALSE, message=FALSE, warning=FALSE}
mnrr <- read.csv("MTA_Performance_MNR.csv")
mnrr <- 
  mnrr %>% 
  select(INDICATOR_SEQ,INDICATOR_NAME,PERIOD_YEAR,YTD_TARGET,YTD_ACTUAL)
mnrr1 <- 
  mnrr %>% 
  filter(INDICATOR_SEQ %in% c(28346,28345,28347,28461,28460))
mnrr1 <-
  mnrr1 %>%
  group_by(INDICATOR_NAME,PERIOD_YEAR) %>%
  summarise(avgtarget=mean(YTD_TARGET),avgactual=mean(YTD_ACTUAL))
knitr::kable(mnrr1)
```

### Hudson Line

Below is the Metro North Hudson line, where we will analyse the data on the percentage that the trains arrive on time.

```{r, echo=FALSE, message=FALSE, warning=FALSE}
mnrr <- read.csv("MTA_Performance_MNR.csv")
mnrr <- 
  mnrr %>% 
  select(INDICATOR_SEQ,INDICATOR_NAME,PERIOD_YEAR,YTD_TARGET,YTD_ACTUAL)
hudson  <- 
  mnrr %>% 
  filter(INDICATOR_SEQ==28345)
hudson <-
  hudson %>%
  group_by(PERIOD_YEAR) %>%
  summarise(avgtarget=mean(YTD_TARGET),avgactual=mean(YTD_ACTUAL))
knitr::kable(hudson)
```

Below is the data used for the graph above, which explains the percentage that the trains arrive on time per year. The type shows the difference between the actual and target (predicted) data gathered for the MNRR Hudson Line.

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.width=6, fig.height=4}
mnrrh <- read.csv("mnrrh.csv")
mnrrh %>% 
  ggplot(aes(x=PERIOD_YEAR,y=count,color=type)) +
  stat_smooth() +
  geom_point() + 
  xlab("Year") + 
  ylab("% of on time arrivals") +
  ggtitle("Arrival Times for the Hudson Line")
```

### Port Jervis Line 

Below is the Port Jervis line, where we will analyse the data on the percentage that the trains arrive on time along with its graph.

```{r, echo=FALSE, message=FALSE, warning=FALSE}
mnrr <- read.csv("MTA_Performance_MNR.csv")
mnrr <- 
  mnrr %>% 
  select(INDICATOR_SEQ,INDICATOR_NAME,PERIOD_YEAR,YTD_TARGET,YTD_ACTUAL)
pjl  <- 
  mnrr %>% 
  filter(INDICATOR_SEQ==28460)
pjl <-
  pjl %>%
  group_by(PERIOD_YEAR) %>%
  summarise(avgtarget=mean(YTD_TARGET),avgactual=mean(YTD_ACTUAL))
knitr::kable(pjl)
```

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.width=6, fig.height=4}
mnrr <- read.csv("mnrr.csv")
pjl <-
  mnrr %>%
  filter(INDICATOR_SEQ==28460)
pjl <-
  pjl %>%
  select(INDICATOR_NAME,PERIOD_YEAR,count,type)
pjl %>% 
  ggplot(aes(x=PERIOD_YEAR,y=count,color=type)) +
  stat_smooth() +
  geom_point() + 
  xlab("Year") + 
  ylab("% of on time arrivals") +
  ggtitle("Arrival Times for the Port Jervis Line")
```


### New Haven Line

Below is the New Haven line, where we will analyse the data on the percentage that the trains arrive on time along with its graph.

```{r, echo=FALSE, message=FALSE, warning=FALSE}
mnrr <- read.csv("MTA_Performance_MNR.csv")
mnrr <- 
  mnrr %>% 
  select(INDICATOR_SEQ,INDICATOR_NAME,PERIOD_YEAR,YTD_TARGET,YTD_ACTUAL)
nhl  <- 
  mnrr %>% 
  filter(INDICATOR_SEQ==28347)
nhl <-
  nhl %>%
  group_by(PERIOD_YEAR) %>%
  summarise(avgtarget=mean(YTD_TARGET),avgactual=mean(YTD_ACTUAL))
knitr::kable(nhl)
```

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.width=6, fig.height=4}
mnrr <- read.csv("mnrr.csv")
nhl <-
  mnrr %>%
  filter(INDICATOR_SEQ==28347)
nhl <-
  nhl %>%
  select(INDICATOR_NAME,PERIOD_YEAR,count,type)
nhl %>% 
  ggplot(aes(x=PERIOD_YEAR,y=count,color=type)) +
  stat_smooth() +
  geom_point() + 
  xlab("Year") + 
  ylab("% of on time arrivals") +
  ggtitle("Arrival Times for the New Haven Line")
```

### Harlem Line

Below is the Harlem line, where we will analyse the data on the percentage that the trains arrive on time along with its graph.

```{r, echo=FALSE, message=FALSE, warning=FALSE}
mnrr <- read.csv("MTA_Performance_MNR.csv")
mnrr <- 
  mnrr %>% 
  select(INDICATOR_SEQ,INDICATOR_NAME,PERIOD_YEAR,YTD_TARGET,YTD_ACTUAL)
hl  <- 
  mnrr %>% 
  filter(INDICATOR_SEQ==28346)
hl <-
  hl %>%
  group_by(PERIOD_YEAR) %>%
  summarise(avgtarget=mean(YTD_TARGET),avgactual=mean(YTD_ACTUAL))
knitr::kable(hl)
```

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.width=6, fig.height=4}
mnrr <- read.csv("mnrr.csv")
hl <-
  mnrr %>%
  filter(INDICATOR_SEQ==28346)
hl <-
  hl %>%
  select(INDICATOR_NAME,PERIOD_YEAR,count,type)
hl %>% 
  ggplot(aes(x=PERIOD_YEAR,y=count,color=type)) +
  stat_smooth() +
  geom_point() + 
  xlab("Year") + 
  ylab("% of on time arrivals") +
  ggtitle("Arrival Times for the Harlem Line")
```

### Pascack Valley Line

Below is the Pascack Valley line, where we will analyse the data on the percentage that the trains arrive on time along with its graph.

```{r, echo=FALSE, message=FALSE, warning=FALSE}
mnrr <- read.csv("MTA_Performance_MNR.csv")
mnrr <- 
  mnrr %>% 
  select(INDICATOR_SEQ,INDICATOR_NAME,PERIOD_YEAR,YTD_TARGET,YTD_ACTUAL)
pvl  <- 
  mnrr %>% 
  filter(INDICATOR_SEQ==28461)
pvl <-
  pvl %>%
  group_by(PERIOD_YEAR) %>%
  summarise(avgtarget=mean(YTD_TARGET),avgactual=mean(YTD_ACTUAL))
knitr::kable(pvl)
```

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.width=6, fig.height=4}
mnrr <- read.csv("mnrr.csv")
pvl <-
  mnrr %>%
  filter(INDICATOR_SEQ==28461)
pvl <-
  pvl %>%
  select(INDICATOR_NAME,PERIOD_YEAR,count,type)
pvl %>% 
  ggplot(aes(x=PERIOD_YEAR,y=count,color=type)) +
  stat_smooth() +
  geom_point() + 
  xlab("Year") + 
  ylab("% of on time arrivals") +
  ggtitle("Arrival Times for the Pascack Valley Line")
```

### MNRR Trunk Lines

Below shows the comparisons between all the MNRR trunk line actual and target arrival times, with each indicator name being the name of the MNRR trunk line.

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.width=6, fig.height=4}
mnrr <- read.csv("mnrr.csv")
mnrr1 <- 
  mnrr %>% 
  filter(INDICATOR_SEQ %in% c(28346,28345,28347,28461,28460))
mnrra <-
  mnrr1 %>%
  filter(type == "actual")
mnrra %>% 
  ggplot(aes(x=PERIOD_YEAR,y=count,color=INDICATOR_NAME)) +
  stat_smooth() +
  geom_point() + 
  xlab("Year") + 
  ylab("% of on time arrivals") +
  ggtitle("Actual Arrival Times for Each Trunk Line")
```

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.width=6, fig.height=4}
mnrr <- read.csv("mnrr.csv")
mnrr1 <- 
  mnrr %>% 
  filter(INDICATOR_SEQ %in% c(28346,28345,28347,28461,28460))
mnrrt <-
  mnrr1 %>%
  filter(type == "target")
mnrrt %>% 
  ggplot(aes(x=PERIOD_YEAR,y=count,color=INDICATOR_NAME)) +
  stat_smooth() +
  geom_point() + 
  xlab("Year") + 
  ylab("% of on time arrivals") +
  ggtitle("Target Arrival Times for Each Trunk Line")
```

## Total Ridership

Below is the total ridership over the years from 2008 to 2010, and the MTA also included the target ridership per year. 

```{r echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
mnrr <- read.csv("MTA_Performance_MNR.csv")
mnrr <- 
  mnrr %>% 
  select(INDICATOR_SEQ,INDICATOR_NAME,PERIOD_YEAR,YTD_TARGET,YTD_ACTUAL)
ridership <-
  mnrr %>%
  filter(INDICATOR_SEQ==55512)
ridership <-
  ridership %>%
  group_by(PERIOD_YEAR) %>%
  summarise(avgtarget=mean(YTD_TARGET),avgactual=mean(YTD_ACTUAL))
knitr::kable(ridership)
```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
mnrr <- read.csv("mnrr.csv")
ridership <-
  mnrr %>%
  filter(INDICATOR_SEQ==55512)
ridership %>% 
  ggplot(aes(x=PERIOD_YEAR,y=count,color=type)) +
  stat_smooth() +
  geom_point() + 
  xlab("Year") + 
  ylab("Total Ridership") +
  ggtitle("Annual Ridership for the Metro North")
```

You notice that there is a decrease in ridership from 2015 to 2017 since there were incidents that occured. Also, 2017 is not complete as of yet since it only goes up to November of 2017. There was also derailments that did affect the line throughout these years that affected the lines along with Penn Station being closed down to fix the tracks. Amtrak had to use the tracks in Grand Central, which shared the tracks along with Metro North.

## Customer Injury Rate

Below is the table for the customer injury rate from 2008 through 2017.  

```{r echo=FALSE, message=FALSE, warning=FALSE}
mnrr <- read.csv("MTA_Performance_MNR.csv")
mnrr <- 
  mnrr %>% 
  select(INDICATOR_SEQ,INDICATOR_NAME,PERIOD_YEAR,YTD_TARGET,YTD_ACTUAL)
ir <-
  mnrr %>%
  filter(INDICATOR_SEQ==28530)
ir <-
  ir %>%
  group_by(PERIOD_YEAR) %>%
  summarise(avgtarget=mean(YTD_TARGET),avgactual=mean(YTD_ACTUAL))
knitr::kable(ir)
```

Below is the graph that compares the targeted injury rates and the actual injury rates.

```{r echo=FALSE, message=FALSE, warning=FALSE}
mnrr <- read.csv("mnrr.csv")
ir <-
  mnrr %>%
  filter(INDICATOR_SEQ==28530)
ir %>% 
  ggplot(aes(x=PERIOD_YEAR,y=count,color=type)) +
  stat_smooth() +
  geom_point() + 
  xlab("Year") + 
  ylab("Total Ridership") +
  ggtitle("Annual Customer Injury Rates for the Metro North")
```

The actual customer injury rates did show an decrease from 2014 through present due to advertisements and actions made in order to prevent any further injuries. Some actions taken will be to prevent customers from jumping into the tracks, etc.

