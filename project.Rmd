---
title: "The Metropolitan Transportation Authority of New York City"
author: "Anthony Josue Roman"
output: 
  html_document:
    fig_height: 3
    fig_width: 5
---
<!-- Don't edit in between this line and the one below -->
```{r include=FALSE}
# Don't delete this chunk if you are using the DataComputing package
library(DataComputing)
library(mosaic)
library(mosaicData)
library(dplyr)
library(ggplot2)
library(gtfsr)
library(magrittr)
library(dplyr)
require(DataComputing)
require(mosaic)
require(mosaicData)
require(dplyr)
require(ggplot2)
require(gtfsr)
require(magrittr)
require(dplyr)
```
*Source file* 
```{r, results='asis', echo=FALSE}
includeSourceDocuments()
```
<!-- Don't edit the material above this line -->

Note: Actual document is on [here](https://aromedtbf.github.io/STAT-184/), whereas this is just an html link for the gtfs document to work.

I will begin analysing the data provided from New York City's transportation authority, also known as the MTA. The following data used will include success and failure rates for each department.  
In order to use this data, I had to apply through its website in order to obtain this data. The given data will be provided along with this file, and in the website. In order to make this data easier to read, there were csv files created in order to yield a viable graph and for data wrangling purposes.

New York City is one of the most populated cities in the world, and has one of the largest public transportation systems in the world as well. Below is a representation of the New York City Transit.
```{r eval=FALSE, message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}
# use this in order to have the program to work just uncomment:
#if (!require(devtools)) {
#    install.packages('devtools')
#}
#devtools::install_github('ropensci/gtfsr')
```
```{r echo=FALSE, fig.height=10, fig.width=10, message=FALSE, warning=FALSE, paged.print=TRUE}
# Uncomment and use set_api_key() on console Use enter this key on console when it asks 
# for the prompt:
# b742b4e5-f67d-4eac-9c90-770c2a5bc5f5
# then this should work
feedlist_df <- get_feedlist() %>%
  filter(grepl('NYC Subway GTFS', t, ignore.case= TRUE))
NYC <- import_gtfs(feedlist_df$url_d)
routes <- NYC[['routes_df']] %>%
  slice(which(grepl('1|2|3|4|5|6|7|a|b|c|d|e|f|g|j|m|n|q|r|s|w|z', route_id, ignore.case=TRUE))) %>%
  '$'('route_id')
NYC %>% map_gtfs(route_ids = routes)
```

## New York City Bus

Below is a comparison between the Completed and projected Trips from MTA Bus and MTA New York City Bus. Note: On 2012, Hurricane Sandy did affect service, along with other years due to suspension of service.

```{r, echo=FALSE, fig.height=6, fig.width=10, message=FALSE, warning=FALSE, fig.width=6, fig.height=4}
bustripdata <- read.csv("bustrip.csv")
bustripdata %>% 
  ggplot(aes(x=PERIOD_YEAR,y=count,color=type)) +
  stat_smooth() +
  geom_point() + 
  xlab("Year") + 
  ylab("% of Completed Trips") +
  ggtitle("Complteted trips for the New York City Bus")
```
  
Below is the data used for the graph above, which explains the completed trip percentage per year. The type shows the difference between the actual and target (predicted) data gathered for NYCT Bus.

```{r, echo=FALSE, message=FALSE, warning=FALSE}
bustripdata <- read.csv("bustrip.csv")
knitr::kable(bustripdata)
```

## Metro North Railroad

This is the Metro North Railroad with multiple indicator types, and I will focus on the MNRR Hudson Harlem and Port Jervis Lines.

```{r, echo=FALSE, message=FALSE, warning=FALSE}
mnrr <- read.csv("MTA_Performance_MNR.csv")
mnrr <- 
  mnrr %>% 
  select(INDICATOR_SEQ,INDICATOR_NAME,PERIOD_YEAR,YTD_TARGET,YTD_ACTUAL)
mnrr1 <- 
  mnrr %>% 
  filter(INDICATOR_SEQ %in% c(28346,28345,28347,28461,28460))
mnrr1 <-
  mnrr1 %>%
  group_by(INDICATOR_NAME,PERIOD_YEAR) %>%
  summarise(avgtarget=mean(YTD_TARGET),avgactual=mean(YTD_ACTUAL))
knitr::kable(mnrr1)
```

### Hudson Line

Below is the Metro North Hudson line, where we will analyse the data on the percentage that the trains arrive on time.

```{r echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
mnrr <- read.csv("MTA_Performance_MNR.csv")
mnrr <- 
  mnrr %>% 
  select(INDICATOR_SEQ,INDICATOR_NAME,PERIOD_YEAR,YTD_TARGET,YTD_ACTUAL)
hudson  <- 
  mnrr %>% 
  filter(INDICATOR_SEQ==28345)
hudson <-
  hudson %>%
  group_by(PERIOD_YEAR) %>%
  summarise(avgtarget=mean(YTD_TARGET),avgactual=mean(YTD_ACTUAL))
knitr::kable(hudson)
```

Below is the data used for the graph above, which explains the percentage that the trains arrive on time per year. The type shows the difference between the actual and target (predicted) data gathered for the MNRR Hudson Line.

```{r, echo=FALSE, fig.height=6, fig.width=10, message=FALSE, warning=FALSE, fig.width=6, fig.height=4}
mnrrh <- read.csv("mnrrh.csv")
mnrrh %>% 
  ggplot(aes(x=PERIOD_YEAR,y=count,color=type)) +
  stat_smooth() +
  geom_point() + 
  xlab("Year") + 
  ylab("% of on time arrivals") +
  ggtitle("Arrival Times for the Hudson Line")
```

### Port Jervis Line 

Below is the Port Jervis line, where we will analyse the data on the percentage that the trains arrive on time along with its graph.

```{r, echo=FALSE, message=FALSE, warning=FALSE}
mnrr <- read.csv("MTA_Performance_MNR.csv")
mnrr <- 
  mnrr %>% 
  select(INDICATOR_SEQ,INDICATOR_NAME,PERIOD_YEAR,YTD_TARGET,YTD_ACTUAL)
pjl  <- 
  mnrr %>% 
  filter(INDICATOR_SEQ==28460)
pjl <-
  pjl %>%
  group_by(PERIOD_YEAR) %>%
  summarise(avgtarget=mean(YTD_TARGET),avgactual=mean(YTD_ACTUAL))
knitr::kable(pjl)
```

```{r, echo=FALSE, fig.height=6, fig.width=10, message=FALSE, warning=FALSE, fig.width=6, fig.height=4}
mnrr <- read.csv("mnrr.csv")
pjl <-
  mnrr %>%
  filter(INDICATOR_SEQ==28460)
pjl <-
  pjl %>%
  select(INDICATOR_NAME,PERIOD_YEAR,count,type)
pjl %>% 
  ggplot(aes(x=PERIOD_YEAR,y=count,color=type)) +
  stat_smooth() +
  geom_point() + 
  xlab("Year") + 
  ylab("% of on time arrivals") +
  ggtitle("Arrival Times for the Port Jervis Line")
```


### New Haven Line

Below is the New Haven line, where we will analyse the data on the percentage that the trains arrive on time along with its graph.

```{r, echo=FALSE, message=FALSE, warning=FALSE}
mnrr <- read.csv("MTA_Performance_MNR.csv")
mnrr <- 
  mnrr %>% 
  select(INDICATOR_SEQ,INDICATOR_NAME,PERIOD_YEAR,YTD_TARGET,YTD_ACTUAL)
nhl  <- 
  mnrr %>% 
  filter(INDICATOR_SEQ==28347)
nhl <-
  nhl %>%
  group_by(PERIOD_YEAR) %>%
  summarise(avgtarget=mean(YTD_TARGET),avgactual=mean(YTD_ACTUAL))
knitr::kable(nhl)
```

```{r, echo=FALSE, fig.height=6, fig.width=10, message=FALSE, warning=FALSE, fig.width=6, fig.height=4}
mnrr <- read.csv("mnrr.csv")
nhl <-
  mnrr %>%
  filter(INDICATOR_SEQ==28347)
nhl <-
  nhl %>%
  select(INDICATOR_NAME,PERIOD_YEAR,count,type)
nhl %>% 
  ggplot(aes(x=PERIOD_YEAR,y=count,color=type)) +
  stat_smooth() +
  geom_point() + 
  xlab("Year") + 
  ylab("% of on time arrivals") +
  ggtitle("Arrival Times for the New Haven Line")
```

### Harlem Line

Below is the Harlem line, where we will analyse the data on the percentage that the trains arrive on time along with its graph.

```{r, echo=FALSE, message=FALSE, warning=FALSE}
mnrr <- read.csv("MTA_Performance_MNR.csv")
mnrr <- 
  mnrr %>% 
  select(INDICATOR_SEQ,INDICATOR_NAME,PERIOD_YEAR,YTD_TARGET,YTD_ACTUAL)
hl  <- 
  mnrr %>% 
  filter(INDICATOR_SEQ==28346)
hl <-
  hl %>%
  group_by(PERIOD_YEAR) %>%
  summarise(avgtarget=mean(YTD_TARGET),avgactual=mean(YTD_ACTUAL))
knitr::kable(hl)
```

```{r, echo=FALSE, fig.height=6, fig.width=10, message=FALSE, warning=FALSE, fig.width=6, fig.height=4}
mnrr <- read.csv("mnrr.csv")
hl <-
  mnrr %>%
  filter(INDICATOR_SEQ==28346)
hl <-
  hl %>%
  select(INDICATOR_NAME,PERIOD_YEAR,count,type)
hl %>% 
  ggplot(aes(x=PERIOD_YEAR,y=count,color=type)) +
  stat_smooth() +
  geom_point() + 
  xlab("Year") + 
  ylab("% of on time arrivals") +
  ggtitle("Arrival Times for the Harlem Line")
```

### Pascack Valley Line

Below is the Pascack Valley line, where we will analyse the data on the percentage that the trains arrive on time along with its graph.

```{r, echo=FALSE, message=FALSE, warning=FALSE}
mnrr <- read.csv("MTA_Performance_MNR.csv")
mnrr <- 
  mnrr %>% 
  select(INDICATOR_SEQ,INDICATOR_NAME,PERIOD_YEAR,YTD_TARGET,YTD_ACTUAL)
pvl  <- 
  mnrr %>% 
  filter(INDICATOR_SEQ==28461)
pvl <-
  pvl %>%
  group_by(PERIOD_YEAR) %>%
  summarise(avgtarget=mean(YTD_TARGET),avgactual=mean(YTD_ACTUAL))
knitr::kable(pvl)
```

```{r, echo=FALSE, fig.height=6, fig.width=10, message=FALSE, warning=FALSE, fig.width=6, fig.height=4}
mnrr <- read.csv("mnrr.csv")
pvl <-
  mnrr %>%
  filter(INDICATOR_SEQ==28461)
pvl <-
  pvl %>%
  select(INDICATOR_NAME,PERIOD_YEAR,count,type)
pvl %>% 
  ggplot(aes(x=PERIOD_YEAR,y=count,color=type)) +
  stat_smooth() +
  geom_point() + 
  xlab("Year") + 
  ylab("% of on time arrivals") +
  ggtitle("Arrival Times for the Pascack Valley Line")
```

### MNRR Trunk Lines

Below shows the comparisons between all the MNRR trunk line actual and target arrival times, with each indicator name being the name of the MNRR trunk line.

```{r echo=FALSE, fig.height=6, fig.width=10, message=FALSE, warning=FALSE}
mnrr <- read.csv("mnrr.csv")
mnrr1 <- 
  mnrr %>% 
  filter(INDICATOR_SEQ %in% c(28346,28345,28347,28461,28460))
mnrra <-
  mnrr1 %>%
  filter(type == "actual")
mnrra %>% 
  ggplot(aes(x=PERIOD_YEAR,y=count,color=INDICATOR_NAME)) +
  stat_smooth() +
  geom_point() + 
  xlab("Year") + 
  ylab("% of on time arrivals") +
  ggtitle("Actual Arrival Times for Each Trunk Line")
```

```{r echo=FALSE, fig.height=6, fig.width=10, message=FALSE, warning=FALSE}
mnrr <- read.csv("mnrr.csv")
mnrr1 <- 
  mnrr %>% 
  filter(INDICATOR_SEQ %in% c(28346,28345,28347,28461,28460))
mnrrt <-
  mnrr1 %>%
  filter(type == "target")
mnrrt %>% 
  ggplot(aes(x=PERIOD_YEAR,y=count,color=INDICATOR_NAME)) +
  stat_smooth() +
  geom_point() + 
  xlab("Year") + 
  ylab("% of on time arrivals") +
  ggtitle("Target Arrival Times for Each Trunk Line")
```

## Total Ridership

Below is the total ridership over the years from 2008 to 2010, and the MTA also included the target ridership per year. 

```{r echo=FALSE, message=FALSE, warning=FALSE}
mnrr <- read.csv("MTA_Performance_MNR.csv")
mnrr <- 
  mnrr %>% 
  select(INDICATOR_SEQ,INDICATOR_NAME,PERIOD_YEAR,YTD_TARGET,YTD_ACTUAL)
ridership <-
  mnrr %>%
  filter(INDICATOR_SEQ==55512)
ridership <-
  ridership %>%
  group_by(PERIOD_YEAR) %>%
  summarise(avgtarget=mean(YTD_TARGET),avgactual=mean(YTD_ACTUAL))
knitr::kable(ridership)
```

```{r echo=FALSE, fig.height=6, fig.width=10, message=FALSE, warning=FALSE}
mnrr <- read.csv("mnrr.csv")
ridership <-
  mnrr %>%
  filter(INDICATOR_SEQ==55512)
ridership %>% 
  ggplot(aes(x=PERIOD_YEAR,y=count,color=type)) +
  stat_smooth() +
  geom_point() + 
  xlab("Year") + 
  ylab("Total Ridership") +
  ggtitle("Annual Ridership for the Metro North")
```
